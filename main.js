!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_error",errorClass:"modal__error-text_active"};var t=class{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._errorClass=e.errorClass,this._inputErrorClass=e.inputErrorClass,this._inactiveButtonClass=e.inactiveButtonClass,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}_toggleButtonState(){this._hasInvalidInput(this._inputList)?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_showInputError(e,t){const r=`.${e.id}-error`,n=this._formElement.querySelector(r);e.classList.add(this._inputErrorClass),n.textContent=t,n.classList.add(this._errorClass)}_hideInputError(e){const t=`.${e.id}-error`,r=this._formElement.querySelector(t);e.classList.remove(this._inputErrorClass),r.classList.remove(this._errorClass),r.textContent=""}resetValidation(){this._formElement.reset(),this._toggleButtonState()}};const r=document.querySelector("#profile-modal"),n=r.querySelector(".modal__submit-button"),o=document.querySelector("#new-post-modal"),s=o.querySelector(".modal__submit-button"),a=document.querySelector("#preview-modal"),i=a.querySelector(".modal__image-caption"),l=a.querySelector(".modal__image"),c=document.querySelector("#delete-post-modal"),d=c.querySelector(".modal__submit-button"),u=c.querySelector(".modal__submit-button_cancel"),_=document.querySelector("#avatar-modal"),m=_.querySelector(".modal__submit-button"),h=document.querySelector(".profile"),v=h.querySelector("#edit-profile"),p=h.querySelector(".profile__new-post"),f=h.querySelector(".profile__name"),y=h.querySelector(".profile__desc"),E=h.querySelector(".profile__avatar"),S=h.querySelector(".profile__avatar-overlay"),b=document.querySelector(".cards"),q=document.forms["edit-profile-form"],L=document.forms["new-post-form"],C=document.forms["avatar-form"],k=q.querySelector("#name"),g=q.querySelector("#description"),I=L.querySelector("#post-link"),w=L.querySelector("#post-caption"),x=C.querySelector("#avatar-link"),B=document.forms["delete-post-form"],D=document.querySelectorAll(".modal__close-button"),V=new t(e,q),A=new t(e,L),T=new t(e,C),$=new class{constructor(e){this._url=e.url,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}_request(e,t){return fetch(`${this._url}/${e}`,t).then(this._checkResponse)}_getInitialCards(){return this._request("cards",{headers:this._headers})}_getUserInfo(){return this._request("users/me",{headers:this._headers})}loadInitialContent(){return Promise.all([this._getInitialCards(),this._getUserInfo()]).then((e=>{let[t,r]=e;return{cards:t,userData:r}}))}editUserInfo(e){let{name:t,about:r}=e;return this._request("users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})})}editAvatar(e){let{avatar:t}=e;return this._request("users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})})}addNewCard(e){let{name:t,link:r}=e;return this._request("cards",{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})})}removeCard(e){let{cardId:t}=e;return this._request(`cards/${t}`,{method:"DELETE",headers:this._headers})}toggleLike(e){let{isLiked:t,cardId:r}=e;return this._request(`cards/${r}/likes`,{method:t?"DELETE":"PUT",headers:this._headers})}}({url:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"13430c32-a8ca-4f0e-9fc3-4da36101b73c","Content-Type":"application/json"}});function N(e){e.classList.toggle("modal_opened"),e.classList.contains("modal_opened")?O():j()}function P(e){l.src=e.target.src,l.alt=e.target.alt,i.textContent=e.target.alt,N(a)}D.forEach((e=>{const t=e.closest(".modal");e.addEventListener("click",(()=>N(t)))})),u.addEventListener("click",(()=>{N(c)})),v.addEventListener("click",(function(){k.value=f.textContent,g.value=y.textContent,k.dispatchEvent(new Event("input")),g.dispatchEvent(new Event("input")),N(r)})),p.addEventListener("click",(function(){N(o)})),S.addEventListener("click",(function(){N(_)})),q.addEventListener("submit",(function(e){e.preventDefault(),J(!0,n),$.editUserInfo({name:k.value,about:g.value}).then((e=>{f.textContent=e.name,y.textContent=e.about,N(r)})).catch((e=>{console.error(e)})).finally((()=>{J(!1,n)}))})),L.addEventListener("submit",(function(e){e.preventDefault(),J(!0,s);const t={link:I.value,name:w.value};$.addNewCard(t).then((e=>{const t=F(e);b.prepend(t),A.resetValidation(),N(o)})).catch((e=>{console.error(e)})).finally((()=>{J(!1,s)}))})),C.addEventListener("submit",(function(e){e.preventDefault(),J(!0,m),$.editAvatar({avatar:x.value}).then((e=>{E.src=e.avatar,E.alt=e.name,C.reset(),T.resetValidation(),N(_)})).catch((e=>{console.error(e)})).finally((()=>{J(!1,m)}))}));const U=e=>{"Escape"===e.key&&N(document.querySelector(".modal_opened"))},O=()=>{document.addEventListener("keydown",U)},j=()=>{document.removeEventListener("keydown",U)};function J(e,t){t.textContent=e?"Saving...":"Save"}function H(e,t){t.textContent=e?"Deleting...":"Delete"}function R(e){$.toggleLike({isLiked:e.target.classList.contains("card__like-button_liked"),cardId:e.target.closest(".card").id}).then((()=>{e.target.classList.toggle("card__like-button_liked")})).catch((e=>{console.error(e)}))}let z;function M(e){z=e.target.closest(".card"),N(c)}function F(e){const t=document.querySelector("#card-template").content.cloneNode(!0),r=t.querySelector(".card__image"),n=t.querySelector(".card__description"),o=t.querySelector(".card__like-button");return o.addEventListener("click",R),e.isLiked&&o.classList.add("card__like-button_liked"),t.querySelector(".card__delete-button").addEventListener("click",M),r.addEventListener("click",P),r.src=e.link,r.alt=e.name,r.closest(".card").id=e._id,n.textContent=e.name,t}document.querySelectorAll(".modal").forEach((e=>{e.addEventListener("click",(t=>{t.target===e&&N(e)}))})),B.addEventListener("submit",(function(e){e.preventDefault(),H(!0,d),$.removeCard({cardId:z.id}).then((()=>{z.remove(),N(c)})).catch((e=>{console.error(e)})).finally((()=>{H(!1,d)}))})),$.loadInitialContent().then((e=>{let{cards:t,userData:r}=e;t.forEach((e=>{const t=F(e);b.append(t)})),f.textContent=r.name,y.textContent=r.about,E.src=r.avatar})).catch((e=>{console.error(e)})),V.enableValidation(),A.enableValidation(),T.enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q1pBLEVBQU0xRyxpQkFBaUIsU0FBVUksSUFDekJBLEVBQUk2RyxTQUFXUCxHQUNmRCxFQUFZQyxFQUNoQixHQUNGLElBd0RWcEQsRUFBZXRELGlCQUFpQixVQVNoQyxTQUEwQkksR0FDdEJBLEVBQUlDLGlCQUNKaUksR0FBYyxFQUFNckcsR0FDcEIyQixFQUFJc0MsV0FBVyxDQUFFRSxPQUFRb0MsRUFBYXJILEtBQ2pDeUQsTUFBSyxLQUNGNEQsRUFBYTlILFNBQ2IrRixFQUFZekUsRUFBZ0IsSUFFL0J5RixPQUFPQyxJQUNKQyxRQUFRQyxNQUFNRixFQUFJLElBRXJCRyxTQUFRLEtBQ0xTLEdBQWMsRUFBT3JHLEVBQXVCLEdBRXhELElBaUNBMkIsRUFBSW1CLHFCQUNDSCxNQUFLSyxJQUF5QixJQUF4QixNQUFFQyxFQUFLLFNBQUVDLEdBQVVGLEVBQ1ZDLEVBUlhwRixTQUFTNEksSUFDVixNQUFNWCxFQUFjQyxFQUFlVSxHQUNuQzlGLEVBQVVzRyxPQUFPbkIsRUFBWSxJQU83QnZGLEVBQVluQixZQUFjOEQsRUFBU0csS0FDbkM3QyxFQUFZcEIsWUFBYzhELEVBQVNJLE1BQ25DN0MsRUFBY3NFLElBQU03QixFQUFTVyxNQUFNLElBRXRDMkIsT0FBT0MsSUFDSkMsUUFBUUMsTUFBTUYsRUFBSSxJQU8xQmxFLEVBQWlCckQsbUJBQ2pCdUQsRUFBaUJ2RCxtQkFDakJ3RCxFQUFnQnhELGtCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vU3BvdHMgR2FsbGVyeS8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vU3BvdHMgR2FsbGVyeS8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vU3BvdHMgR2FsbGVyeS8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9TcG90cyBHYWxsZXJ5Ly4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBpbml0aWFsQ2FyZHMgPSBbXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJHb2xkZW4gZ2F0ZSBicmlkZ2VcIixcclxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNy1waG90by1ieS1ncmlmZmluLXdvb2xkcmlkZ2UtZnJvbS1wZXhlbHMuanBnXCIsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiVmFsIFRob3JlbnNcIixcclxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vZ2l0aHViLmNvbS9yZW9uZGF6ZS1hL3NlX3Byb2plY3Rfc3BvdHMvYmxvYi9tYWluL2ltYWdlcy8xLXBob3RvLWJ5LW1vcml0ei1mZWxkbWFubi1mcm9tLXBleGVscy5qcGc/cmF3PXRydWVcIixcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogXCJSZXN0YXVyYW50IHRlcnJhY2VcIixcclxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vZ2l0aHViLmNvbS9yZW9uZGF6ZS1hL3NlX3Byb2plY3Rfc3BvdHMvYmxvYi9tYWluL2ltYWdlcy8yLXBob3RvLWJ5LWNlaWxpbmUtZnJvbS1wZXhlbHMuanBnP3Jhdz10cnVlXCIsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6IFwiQW4gb3V0ZG9vciBjYWZlXCIsXHJcbiAgICAgICAgbGluazogXCJodHRwczovL2dpdGh1Yi5jb20vcmVvbmRhemUtYS9zZV9wcm9qZWN0X3Nwb3RzL2Jsb2IvbWFpbi9pbWFnZXMvMy1waG90by1ieS10dWJhbnVyLWRvZ2FuLWZyb20tcGV4ZWxzLmpwZz9yYXc9dHJ1ZVwiLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIkEgdmVyeSBsb25nIGJyaWRnZSwgb3ZlciB0aGUgZm9yZXN0IGFjcm9zcyB0aGUgYnJpZGdlXCIsXHJcbiAgICAgICAgbGluazogXCJodHRwczovL2dpdGh1Yi5jb20vcmVvbmRhemUtYS9zZV9wcm9qZWN0X3Nwb3RzL2Jsb2IvbWFpbi9pbWFnZXMvNC1waG90by1ieS1tYXVyaWNlLWxhc2NoZXQtZnJvbS1wZXhlbHMuanBnP3Jhdz10cnVlPlwiLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIlR1bm5lbCB3aXRoIG1vcm5pbmcgbGlnaHRcIixcclxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vZ2l0aHViLmNvbS9yZW9uZGF6ZS1hL3NlX3Byb2plY3Rfc3BvdHMvYmxvYi9tYWluL2ltYWdlcy81LXBob3RvLWJ5LXZhbi1hbmgtbmd1eWVuLWZyb20tcGV4ZWxzLmpwZz9yYXc9dHJ1ZVwiLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBuYW1lOiBcIk1vdW50YWluIGhvdXNlXCIsXHJcbiAgICAgICAgbGluazogXCJodHRwczovL2dpdGh1Yi5jb20vcmVvbmRhemUtYS9zZV9wcm9qZWN0X3Nwb3RzL2Jsb2IvbWFpbi9pbWFnZXMvNi1waG90by1ieS1tb3JpdHotZmVsZG1hbm4tZnJvbS1wZXhlbHMuanBnP3Jhdz10cnVlXCIsXHJcbiAgICB9LFxyXG5dO1xyXG5cclxuY29uc3Qgc2V0dGluZ3MgPSB7XHJcbiAgICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXHJcbiAgICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcclxuICAgIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiLFxyXG4gICAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0LWJ1dHRvbl9kaXNhYmxlZFwiLFxyXG4gICAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF9lcnJvclwiLFxyXG4gICAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3ItdGV4dF9hY3RpdmVcIixcclxufTtcclxuXHJcbmV4cG9ydCB7IGluaXRpYWxDYXJkcywgc2V0dGluZ3MgfTtcclxuIiwiY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgICBjb25zdHJ1Y3Rvcihjb25maWcsIGVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gY29uZmlnLmlucHV0U2VsZWN0b3I7XHJcbiAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3I7XHJcbiAgICAgICAgdGhpcy5fZXJyb3JDbGFzcyA9IGNvbmZpZy5lcnJvckNsYXNzO1xyXG4gICAgICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IGNvbmZpZy5pbnB1dEVycm9yQ2xhc3M7XHJcbiAgICAgICAgdGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyA9IGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzO1xyXG5cclxuICAgICAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5faW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZW5hYmxlVmFsaWRhdGlvbigpIHtcclxuICAgICAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBfdG9nZ2xlQnV0dG9uU3RhdGUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2hhc0ludmFsaWRJbnB1dCh0aGlzLl9pbnB1dExpc3QpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgICAgICAgICB0aGlzLl9idXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9oYXNJbnZhbGlkSW5wdXQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpIHtcclxuICAgICAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgICAgICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlKSB7XHJcbiAgICAgICAgY29uc3QgZXJyb3JFbGVtZW50SWQgPSBgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmA7XHJcbiAgICAgICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihlcnJvckVsZW1lbnRJZCk7XHJcbiAgICAgICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcclxuICAgICAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XHJcbiAgICAgICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgICB9XHJcblxyXG4gICAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xyXG4gICAgICAgIGNvbnN0IGVycm9yRWxlbWVudElkID0gYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgO1xyXG4gICAgICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoZXJyb3JFbGVtZW50SWQpO1xyXG4gICAgICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICAgICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgICAgICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcclxuICAgIH1cclxuXHJcbiAgICByZXNldFZhbGlkYXRpb24oKSB7XHJcbiAgICAgICAgdGhpcy5fZm9ybUVsZW1lbnQucmVzZXQoKTtcclxuICAgICAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBGb3JtVmFsaWRhdG9yO1xyXG4iLCJpbXBvcnQgeyBzZXR0aW5ncyB9IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcclxuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xyXG5pbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xyXG5pbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcclxuXHJcbi8vIE1vZGFsIFZhcmlhYmxlc1xyXG5cclxuLy8vIEVkaXQgUHJvZmlsZSBNb2RhbFxyXG5jb25zdCBlZGl0UHJvZmlsZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLW1vZGFsXCIpO1xyXG5jb25zdCBlZGl0UHJvZmlsZVN1Ym1pdEJ1dHRvbiA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcclxuICAgIFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCJcclxuKTtcclxuXHJcbi8vLyBOZXcgUG9zdCBNb2RhbFxyXG5jb25zdCBuZXdQb3N0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LW1vZGFsXCIpO1xyXG5jb25zdCBuZXdQb3N0U3VibWl0QnV0dG9uID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIik7XHJcblxyXG4vLy8gUHJldmlldyBNb2RhbFxyXG5jb25zdCBwcmV2aWV3TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbW9kYWxcIik7XHJcbmNvbnN0IHByZXZpZXdDYXB0aW9uID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlLWNhcHRpb25cIik7XHJcbmNvbnN0IG1vZGFsSW1hZ2UgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2VcIik7XHJcblxyXG4vLy8gRGVsZXRlIFBvc3QgTW9kYWxcclxuY29uc3QgZGVsZXRlUG9zdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtcG9zdC1tb2RhbFwiKTtcclxuY29uc3QgZGVsZXRlUG9zdFN1Ym1pdEJ1dHRvbiA9IGRlbGV0ZVBvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIlxyXG4pO1xyXG5jb25zdCBkZWxldGVQb3N0Q2FuY2VsQnV0dG9uID0gZGVsZXRlUG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvbl9jYW5jZWxcIlxyXG4pO1xyXG5cclxuLy8gQXZhdGFyIE1vZGFsXHJcbmNvbnN0IGF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItbW9kYWxcIik7XHJcbmNvbnN0IGF2YXRhclN1Ym1pdEJ1dHRvbiA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIik7XHJcblxyXG4vLyBQcm9maWxlIFZhcmlhYmxlc1xyXG5jb25zdCBwcm9maWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlXCIpO1xyXG5jb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IHByb2ZpbGUucXVlcnlTZWxlY3RvcihcIiNlZGl0LXByb2ZpbGVcIik7XHJcbmNvbnN0IHByb2ZpbGVOZXdQb3N0ID0gcHJvZmlsZS5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25ldy1wb3N0XCIpO1xyXG5jb25zdCBwcm9maWxlTmFtZSA9IHByb2ZpbGUucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xyXG5jb25zdCBwcm9maWxlRGVzYyA9IHByb2ZpbGUucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjXCIpO1xyXG5jb25zdCBwcm9maWxlQXZhdGFyID0gcHJvZmlsZS5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcclxuY29uc3QgcHJvZmlsZUF2YXRhck92ZXJsYXkgPSBwcm9maWxlLnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLW92ZXJsYXlcIik7XHJcblxyXG4vLyBDYXJkcyBWYXJpYWJsZXNcclxuY29uc3QgY2FyZHNHcmlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc1wiKTtcclxuXHJcbi8vIEZvcm0gVmFyaWFibGVzXHJcbmNvbnN0IGVkaXRQcm9maWxlRm9ybSA9IGRvY3VtZW50LmZvcm1zW1wiZWRpdC1wcm9maWxlLWZvcm1cIl07XHJcbmNvbnN0IG5ld1Bvc3RGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJuZXctcG9zdC1mb3JtXCJdO1xyXG5jb25zdCBhdmF0YXJGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJhdmF0YXItZm9ybVwiXTtcclxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5jb25zdCBlZGl0UHJvZmlsZU5hbWUgPSBlZGl0UHJvZmlsZUZvcm0ucXVlcnlTZWxlY3RvcihcIiNuYW1lXCIpO1xyXG5jb25zdCBlZGl0UHJvZmlsZURlc2MgPSBlZGl0UHJvZmlsZUZvcm0ucXVlcnlTZWxlY3RvcihcIiNkZXNjcmlwdGlvblwiKTtcclxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5jb25zdCBuZXdQb3N0TGluayA9IG5ld1Bvc3RGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjcG9zdC1saW5rXCIpO1xyXG5jb25zdCBuZXdQb3N0Q2FwdCA9IG5ld1Bvc3RGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjcG9zdC1jYXB0aW9uXCIpO1xyXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbmNvbnN0IGF2YXRhckxpbmsgPSBhdmF0YXJGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLWxpbmtcIik7XHJcbmNvbnN0IGRlbGV0ZVBvc3RGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJkZWxldGUtcG9zdC1mb3JtXCJdO1xyXG5cclxuLy8gQ2xvc2UgYnV0dG9uc1xyXG5jb25zdCBjbG9zZUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19jbG9zZS1idXR0b25cIik7XHJcblxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbmNvbnN0IHZhbGlkYXRvclByb2ZpbGUgPSBuZXcgRm9ybVZhbGlkYXRvcihzZXR0aW5ncywgZWRpdFByb2ZpbGVGb3JtKTtcclxuY29uc3QgdmFsaWRhdG9yTmV3UG9zdCA9IG5ldyBGb3JtVmFsaWRhdG9yKHNldHRpbmdzLCBuZXdQb3N0Rm9ybSk7XHJcbmNvbnN0IHZhbGlkYXRvckF2YXRhciA9IG5ldyBGb3JtVmFsaWRhdG9yKHNldHRpbmdzLCBhdmF0YXJGb3JtKTtcclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4vLyBBUElcclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgICB1cmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgICBhdXRob3JpemF0aW9uOiBcIjEzNDMwYzMyLWE4Y2EtNGYwZS05ZmMzLTRkYTM2MTAxYjczY1wiLFxyXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgfSxcclxufSk7XHJcblxyXG4vLyBNb2RhbCBmdW5jdGlvbnNcclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZU1vZGFsKG1vZGFsKSB7XHJcbiAgICBtb2RhbC5jbGFzc0xpc3QudG9nZ2xlKFwibW9kYWxfb3BlbmVkXCIpO1xyXG4gICAgaWYgKG1vZGFsLmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX29wZW5lZFwiKSkge1xyXG4gICAgICAgIGVuYWJsZUVzY2FwZUNsb3NlKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGRpc2FibGVFc2NhcGVDbG9zZSgpO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVPcGVuTW9kYWxQcm9maWxlKCkge1xyXG4gICAgZWRpdFByb2ZpbGVOYW1lLnZhbHVlID0gcHJvZmlsZU5hbWUudGV4dENvbnRlbnQ7XHJcbiAgICBlZGl0UHJvZmlsZURlc2MudmFsdWUgPSBwcm9maWxlRGVzYy50ZXh0Q29udGVudDtcclxuICAgIGVkaXRQcm9maWxlTmFtZS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChcImlucHV0XCIpKTtcclxuICAgIGVkaXRQcm9maWxlRGVzYy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChcImlucHV0XCIpKTtcclxuICAgIHRvZ2dsZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVPcGVuTW9kYWxOZXdQb3N0KCkge1xyXG4gICAgdG9nZ2xlTW9kYWwobmV3UG9zdE1vZGFsKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlT3Blbk1vZGFsQXZhdGFyKCkge1xyXG4gICAgdG9nZ2xlTW9kYWwoYXZhdGFyTW9kYWwpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdChldnQpIHtcclxuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgbG9hZGluZyh0cnVlLCBlZGl0UHJvZmlsZVN1Ym1pdEJ1dHRvbik7XHJcblxyXG4gICAgYXBpLmVkaXRVc2VySW5mbyh7XHJcbiAgICAgICAgbmFtZTogZWRpdFByb2ZpbGVOYW1lLnZhbHVlLFxyXG4gICAgICAgIGFib3V0OiBlZGl0UHJvZmlsZURlc2MudmFsdWUsXHJcbiAgICB9KVxyXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSByZXMubmFtZTtcclxuICAgICAgICAgICAgcHJvZmlsZURlc2MudGV4dENvbnRlbnQgPSByZXMuYWJvdXQ7XHJcbiAgICAgICAgICAgIHRvZ2dsZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgICAgICBsb2FkaW5nKGZhbHNlLCBlZGl0UHJvZmlsZVN1Ym1pdEJ1dHRvbik7XHJcbiAgICAgICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUF2YXRhckZvcm1TdWJtaXQoZXZ0KSB7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIGxvYWRpbmcodHJ1ZSwgYXZhdGFyU3VibWl0QnV0dG9uKTtcclxuICAgIGFwaS5lZGl0QXZhdGFyKHsgYXZhdGFyOiBhdmF0YXJMaW5rLnZhbHVlIH0pXHJcbiAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgICBwcm9maWxlQXZhdGFyLnNyYyA9IHJlcy5hdmF0YXI7XHJcbiAgICAgICAgICAgIHByb2ZpbGVBdmF0YXIuYWx0ID0gcmVzLm5hbWU7XHJcbiAgICAgICAgICAgIGF2YXRhckZvcm0ucmVzZXQoKTtcclxuICAgICAgICAgICAgdmFsaWRhdG9yQXZhdGFyLnJlc2V0VmFsaWRhdGlvbigpO1xyXG4gICAgICAgICAgICB0b2dnbGVNb2RhbChhdmF0YXJNb2RhbCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGxvYWRpbmcoZmFsc2UsIGF2YXRhclN1Ym1pdEJ1dHRvbik7XHJcbiAgICAgICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUNhcmRGb3JtU3VibWl0KGV2dCkge1xyXG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBsb2FkaW5nKHRydWUsIG5ld1Bvc3RTdWJtaXRCdXR0b24pO1xyXG4gICAgY29uc3QgbmV3Q2FyZCA9IHtcclxuICAgICAgICBsaW5rOiBuZXdQb3N0TGluay52YWx1ZSxcclxuICAgICAgICBuYW1lOiBuZXdQb3N0Q2FwdC52YWx1ZSxcclxuICAgIH07XHJcbiAgICBhcGkuYWRkTmV3Q2FyZChuZXdDYXJkKVxyXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChyZXMpO1xyXG4gICAgICAgICAgICBjYXJkc0dyaWQucHJlcGVuZChjYXJkRWxlbWVudCk7XHJcbiAgICAgICAgICAgIHZhbGlkYXRvck5ld1Bvc3QucmVzZXRWYWxpZGF0aW9uKCk7XHJcbiAgICAgICAgICAgIHRvZ2dsZU1vZGFsKG5ld1Bvc3RNb2RhbCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGxvYWRpbmcoZmFsc2UsIG5ld1Bvc3RTdWJtaXRCdXR0b24pO1xyXG4gICAgICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVQcmV2aWV3TW9kYWwoZXZ0KSB7XHJcbiAgICBtb2RhbEltYWdlLnNyYyA9IGV2dC50YXJnZXQuc3JjO1xyXG4gICAgbW9kYWxJbWFnZS5hbHQgPSBldnQudGFyZ2V0LmFsdDtcclxuICAgIHByZXZpZXdDYXB0aW9uLnRleHRDb250ZW50ID0gZXZ0LnRhcmdldC5hbHQ7XHJcbiAgICB0b2dnbGVNb2RhbChwcmV2aWV3TW9kYWwpO1xyXG59XHJcblxyXG5jbG9zZUJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7XHJcbiAgICBjb25zdCBtb2RhbCA9IGJ1dHRvbi5jbG9zZXN0KFwiLm1vZGFsXCIpO1xyXG4gICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0b2dnbGVNb2RhbChtb2RhbCkpO1xyXG59KTtcclxuXHJcbmRlbGV0ZVBvc3RDYW5jZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgIHRvZ2dsZU1vZGFsKGRlbGV0ZVBvc3RNb2RhbCk7XHJcbn0pO1xyXG5cclxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZU9wZW5Nb2RhbFByb2ZpbGUpO1xyXG5wcm9maWxlTmV3UG9zdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlT3Blbk1vZGFsTmV3UG9zdCk7XHJcbnByb2ZpbGVBdmF0YXJPdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVPcGVuTW9kYWxBdmF0YXIpO1xyXG5lZGl0UHJvZmlsZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XHJcbm5ld1Bvc3RGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQ2FyZEZvcm1TdWJtaXQpO1xyXG5hdmF0YXJGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQXZhdGFyRm9ybVN1Ym1pdCk7XHJcblxyXG5jb25zdCBjbG9zZU1vZGFsT25PdmVybGF5ID0gKCkgPT4ge1xyXG4gICAgY29uc3QgbW9kYWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbFwiKTtcclxuICAgIG1vZGFscy5mb3JFYWNoKChtb2RhbCkgPT4ge1xyXG4gICAgICAgIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChldnQudGFyZ2V0ID09PSBtb2RhbCkge1xyXG4gICAgICAgICAgICAgICAgdG9nZ2xlTW9kYWwobW9kYWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcbmNvbnN0IGNsb3NlS2V5RXNjYXBlID0gKGV2dCkgPT4ge1xyXG4gICAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuICAgICAgICBjb25zdCBvcGVuZWRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfb3BlbmVkXCIpO1xyXG4gICAgICAgIHRvZ2dsZU1vZGFsKG9wZW5lZE1vZGFsKTtcclxuICAgIH1cclxufTtcclxuXHJcbmNvbnN0IGVuYWJsZUVzY2FwZUNsb3NlID0gKCkgPT4ge1xyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgY2xvc2VLZXlFc2NhcGUpO1xyXG59O1xyXG5cclxuY29uc3QgZGlzYWJsZUVzY2FwZUNsb3NlID0gKCkgPT4ge1xyXG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgY2xvc2VLZXlFc2NhcGUpO1xyXG59O1xyXG5cclxuY2xvc2VNb2RhbE9uT3ZlcmxheSgpO1xyXG5cclxuLy8gTG9hZGluZyBmdW5jdGlvbnNcclxuXHJcbmZ1bmN0aW9uIGxvYWRpbmcoaXNMb2FkaW5nLCBidXR0b24pIHtcclxuICAgIGlmIChpc0xvYWRpbmcpIHtcclxuICAgICAgICBidXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBidXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmVcIjtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gbG9hZGluZ0RlbGV0ZShpc0xvYWRpbmcsIGJ1dHRvbikge1xyXG4gICAgaWYgKGlzTG9hZGluZykge1xyXG4gICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IFwiRGVsZXRpbmcuLi5cIjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gXCJEZWxldGVcIjtcclxuICAgIH1cclxufVxyXG5cclxuLy8gTW9kYWwgZnVuY3Rpb25zIGVuZFxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuLy8gQ2FyZHMgZnVuY3Rpb25zXHJcblxyXG5mdW5jdGlvbiBsaWtlQ2FyZChldnQpIHtcclxuICAgIGFwaS50b2dnbGVMaWtlKHtcclxuICAgICAgICBpc0xpa2VkOiBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImNhcmRfX2xpa2UtYnV0dG9uX2xpa2VkXCIpLFxyXG4gICAgICAgIGNhcmRJZDogZXZ0LnRhcmdldC5jbG9zZXN0KFwiLmNhcmRcIikuaWQsXHJcbiAgICB9KVxyXG4gICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idXR0b25fbGlrZWRcIik7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgfSk7XHJcbn1cclxuXHJcbmRlbGV0ZVBvc3RGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlZGVsZXRlUG9zdCk7XHJcblxyXG5sZXQgc2VsZWN0ZWRDYXJkO1xyXG5cclxuZnVuY3Rpb24gZGVsZXRlUG9zdChldnQpIHtcclxuICAgIHNlbGVjdGVkQ2FyZCA9IGV2dC50YXJnZXQuY2xvc2VzdChcIi5jYXJkXCIpO1xyXG4gICAgdG9nZ2xlTW9kYWwoZGVsZXRlUG9zdE1vZGFsKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlZGVsZXRlUG9zdChldnQpIHtcclxuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgbG9hZGluZ0RlbGV0ZSh0cnVlLCBkZWxldGVQb3N0U3VibWl0QnV0dG9uKTtcclxuICAgIGFwaS5yZW1vdmVDYXJkKHsgY2FyZElkOiBzZWxlY3RlZENhcmQuaWQgfSlcclxuICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIHNlbGVjdGVkQ2FyZC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdG9nZ2xlTW9kYWwoZGVsZXRlUG9zdE1vZGFsKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgICAgICAgbG9hZGluZ0RlbGV0ZShmYWxzZSwgZGVsZXRlUG9zdFN1Ym1pdEJ1dHRvbik7XHJcbiAgICAgICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGVsZW0pIHtcclxuICAgIGNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50XHJcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKVxyXG4gICAgICAgIC5jb250ZW50LmNsb25lTm9kZSh0cnVlKTtcclxuXHJcbiAgICBjb25zdCBjYXJkSW1hZ2UgPSBjYXJkVGVtcGxhdGUucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcclxuICAgIGNvbnN0IGNhcmREZXNjID0gY2FyZFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVzY3JpcHRpb25cIik7XHJcbiAgICBjb25zdCBsaWtlQnV0dG9uID0gY2FyZFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XHJcbiAgICBsaWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBsaWtlQ2FyZCk7XHJcbiAgICBpZiAoZWxlbS5pc0xpa2VkKSB7XHJcbiAgICAgICAgbGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fbGlrZWRcIik7XHJcbiAgICB9XHJcblxyXG4gICAgY2FyZFRlbXBsYXRlXHJcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKVxyXG4gICAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZGVsZXRlUG9zdCk7XHJcbiAgICBjYXJkSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZVByZXZpZXdNb2RhbCk7XHJcbiAgICBjYXJkSW1hZ2Uuc3JjID0gZWxlbS5saW5rO1xyXG4gICAgY2FyZEltYWdlLmFsdCA9IGVsZW0ubmFtZTtcclxuICAgIGNhcmRJbWFnZS5jbG9zZXN0KFwiLmNhcmRcIikuaWQgPSBlbGVtLl9pZDtcclxuICAgIGNhcmREZXNjLnRleHRDb250ZW50ID0gZWxlbS5uYW1lO1xyXG4gICAgcmV0dXJuIGNhcmRUZW1wbGF0ZTtcclxufVxyXG5cclxuZnVuY3Rpb24gcmVuZGVyQ2FyZHMoZGF0YSkge1xyXG4gICAgZGF0YS5mb3JFYWNoKChlbGVtKSA9PiB7XHJcbiAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChlbGVtKTtcclxuICAgICAgICBjYXJkc0dyaWQuYXBwZW5kKGNhcmRFbGVtZW50KTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5hcGkubG9hZEluaXRpYWxDb250ZW50KClcclxuICAgIC50aGVuKCh7IGNhcmRzLCB1c2VyRGF0YSB9KSA9PiB7XHJcbiAgICAgICAgcmVuZGVyQ2FyZHMoY2FyZHMpO1xyXG4gICAgICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdXNlckRhdGEubmFtZTtcclxuICAgICAgICBwcm9maWxlRGVzYy50ZXh0Q29udGVudCA9IHVzZXJEYXRhLmFib3V0O1xyXG4gICAgICAgIHByb2ZpbGVBdmF0YXIuc3JjID0gdXNlckRhdGEuYXZhdGFyO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgfSk7XHJcblxyXG4vLyBDYXJkcyBmdW5jdGlvbnMgZW5kXHJcblxyXG4vLyBWYWxpZGF0b3JzXHJcblxyXG52YWxpZGF0b3JQcm9maWxlLmVuYWJsZVZhbGlkYXRpb24oKTtcclxudmFsaWRhdG9yTmV3UG9zdC5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbnZhbGlkYXRvckF2YXRhci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcblxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcclxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLl91cmwgPSBvcHRpb25zLnVybDtcclxuICAgICAgICB0aGlzLl9oZWFkZXJzID0gb3B0aW9ucy5oZWFkZXJzO1xyXG4gICAgfVxyXG5cclxuICAgIF9jaGVja1Jlc3BvbnNlKHJlcykge1xyXG4gICAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH1cclxuXHJcbiAgICBfcmVxdWVzdChleHQsIG9wdGlvbnMpIHtcclxuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fdXJsfS8ke2V4dH1gLCBvcHRpb25zKS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIF9nZXRJbml0aWFsQ2FyZHMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYGNhcmRzYCwge1xyXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIF9nZXRVc2VySW5mbygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgdXNlcnMvbWVgLCB7XHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbG9hZEluaXRpYWxDb250ZW50KCkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5fZ2V0SW5pdGlhbENhcmRzKCksIHRoaXMuX2dldFVzZXJJbmZvKCldKS50aGVuKFxyXG4gICAgICAgICAgICAoW2NhcmRzLCB1c2VyRGF0YV0pID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7IGNhcmRzLCB1c2VyRGF0YSB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYHVzZXJzL21lYCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgICAgICAgbmFtZSxcclxuICAgICAgICAgICAgICAgIGFib3V0LFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBlZGl0QXZhdGFyKHsgYXZhdGFyIH0pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgICAgICAgYXZhdGFyLFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBhZGROZXdDYXJkKHsgbmFtZSwgbGluayB9KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYGNhcmRzYCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgICAgICBuYW1lLFxyXG4gICAgICAgICAgICAgICAgbGluayxcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlQ2FyZCh7IGNhcmRJZCB9KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYGNhcmRzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHRvZ2dsZUxpa2UoeyBpc0xpa2VkLCBjYXJkSWQgfSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGBjYXJkcy8ke2NhcmRJZH0vbGlrZXNgLCB7XHJcbiAgICAgICAgICAgIG1ldGhvZDogaXNMaWtlZCA/IFwiREVMRVRFXCIgOiBcIlBVVFwiLFxyXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiY29uc3RydWN0b3IiLCJjb25maWciLCJlbGVtZW50IiwidGhpcyIsIl9pbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2Vycm9yQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJfZm9ybUVsZW1lbnQiLCJfaW5wdXRMaXN0IiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsIl9idXR0b25FbGVtZW50IiwicXVlcnlTZWxlY3RvciIsIl9zZXRFdmVudExpc3RlbmVycyIsImZvckVhY2giLCJpbnB1dEVsZW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsIl90b2dnbGVCdXR0b25TdGF0ZSIsImVuYWJsZVZhbGlkYXRpb24iLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsIl9oYXNJbnZhbGlkSW5wdXQiLCJjbGFzc0xpc3QiLCJhZGQiLCJkaXNhYmxlZCIsInJlbW92ZSIsInNvbWUiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2hpZGVJbnB1dEVycm9yIiwiX3Nob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJlcnJvck1lc3NhZ2UiLCJlcnJvckVsZW1lbnRJZCIsImlkIiwiZXJyb3JFbGVtZW50IiwidGV4dENvbnRlbnQiLCJyZXNldFZhbGlkYXRpb24iLCJyZXNldCIsImVkaXRQcm9maWxlTW9kYWwiLCJkb2N1bWVudCIsImVkaXRQcm9maWxlU3VibWl0QnV0dG9uIiwibmV3UG9zdE1vZGFsIiwibmV3UG9zdFN1Ym1pdEJ1dHRvbiIsInByZXZpZXdNb2RhbCIsInByZXZpZXdDYXB0aW9uIiwibW9kYWxJbWFnZSIsImRlbGV0ZVBvc3RNb2RhbCIsImRlbGV0ZVBvc3RTdWJtaXRCdXR0b24iLCJkZWxldGVQb3N0Q2FuY2VsQnV0dG9uIiwiYXZhdGFyTW9kYWwiLCJhdmF0YXJTdWJtaXRCdXR0b24iLCJwcm9maWxlIiwicHJvZmlsZUVkaXRCdXR0b24iLCJwcm9maWxlTmV3UG9zdCIsInByb2ZpbGVOYW1lIiwicHJvZmlsZURlc2MiLCJwcm9maWxlQXZhdGFyIiwicHJvZmlsZUF2YXRhck92ZXJsYXkiLCJjYXJkc0dyaWQiLCJlZGl0UHJvZmlsZUZvcm0iLCJmb3JtcyIsIm5ld1Bvc3RGb3JtIiwiYXZhdGFyRm9ybSIsImVkaXRQcm9maWxlTmFtZSIsImVkaXRQcm9maWxlRGVzYyIsIm5ld1Bvc3RMaW5rIiwibmV3UG9zdENhcHQiLCJhdmF0YXJMaW5rIiwiZGVsZXRlUG9zdEZvcm0iLCJjbG9zZUJ1dHRvbnMiLCJ2YWxpZGF0b3JQcm9maWxlIiwiRm9ybVZhbGlkYXRvciIsInZhbGlkYXRvck5ld1Bvc3QiLCJ2YWxpZGF0b3JBdmF0YXIiLCJhcGkiLCJvcHRpb25zIiwiX3VybCIsInVybCIsIl9oZWFkZXJzIiwiaGVhZGVycyIsIl9jaGVja1Jlc3BvbnNlIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsIl9yZXF1ZXN0IiwiZXh0IiwiZmV0Y2giLCJ0aGVuIiwiX2dldEluaXRpYWxDYXJkcyIsIl9nZXRVc2VySW5mbyIsImxvYWRJbml0aWFsQ29udGVudCIsImFsbCIsIl9yZWYiLCJjYXJkcyIsInVzZXJEYXRhIiwiZWRpdFVzZXJJbmZvIiwiX3JlZjIiLCJuYW1lIiwiYWJvdXQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImVkaXRBdmF0YXIiLCJfcmVmMyIsImF2YXRhciIsImFkZE5ld0NhcmQiLCJfcmVmNCIsImxpbmsiLCJyZW1vdmVDYXJkIiwiX3JlZjUiLCJjYXJkSWQiLCJ0b2dnbGVMaWtlIiwiX3JlZjYiLCJpc0xpa2VkIiwiYXV0aG9yaXphdGlvbiIsInRvZ2dsZU1vZGFsIiwibW9kYWwiLCJ0b2dnbGUiLCJjb250YWlucyIsImVuYWJsZUVzY2FwZUNsb3NlIiwiZGlzYWJsZUVzY2FwZUNsb3NlIiwiaGFuZGxlUHJldmlld01vZGFsIiwic3JjIiwidGFyZ2V0IiwiYWx0IiwiYnV0dG9uIiwiY2xvc2VzdCIsInZhbHVlIiwiZGlzcGF0Y2hFdmVudCIsIkV2ZW50IiwibG9hZGluZyIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiZmluYWxseSIsIm5ld0NhcmQiLCJjYXJkRWxlbWVudCIsImdldENhcmRFbGVtZW50IiwicHJlcGVuZCIsImNsb3NlS2V5RXNjYXBlIiwia2V5IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImlzTG9hZGluZyIsImxvYWRpbmdEZWxldGUiLCJsaWtlQ2FyZCIsInNlbGVjdGVkQ2FyZCIsImRlbGV0ZVBvc3QiLCJlbGVtIiwiY2FyZFRlbXBsYXRlIiwiY29udGVudCIsImNsb25lTm9kZSIsImNhcmRJbWFnZSIsImNhcmREZXNjIiwibGlrZUJ1dHRvbiIsIl9pZCIsImFwcGVuZCJdLCJzb3VyY2VSb290IjoiIn0=